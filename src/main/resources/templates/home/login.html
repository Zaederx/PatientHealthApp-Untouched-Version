<!DOCTYPE HTML>
<!--  <%@ taglib uri= "htttp://www.springframework.org/tags/form" prefix="form" %> -->
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <!-- Popper JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>
<div class="jumbotron text-center">
  <h1>Login</h1>
  <h3>Just one step, and your're on your way</h3>
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark justify-content-center row">
        <ul class="navbar-nav">
          <li class="nav-item" >
            <a class="nav-link" th:href="@{/home}"><button class="btn btn-primary">Home</button></a>
          </li>
          <li class="nav-item" >
            <a class="nav-link" th:href="@{/login}"><button class="btn btn-secondary active">Login</button></a>
          </li>
          <li class="nav-item" >
            <a class="nav-link" th:href="@{/home/register}"><button class="btn btn-primary">Register</button></a>
          </li>
        </ul>
      </nav>
</div>

<div class="container text-center col-sm-2">
<div  th:if="${param.error}" class="alert alert-info show">Login unsuccessful.</div>
<div th:if="${param.logout}" class="alert alert-primary show">You have successfully logged out.</div>
  <!--  <form: form :action="${page.Context.request.contextPath}/authenticateUser" method="POST">-->
  <form class="form-group" th:action="@{/validate}" th:object="${userLoginForm}" method="POST">

    <label> Username: </label>
    <input id="username" class="form-control" type="text" name="username" th:field="*{username}" /> <br>
    <p class="alert alert-info" th:if="${#fields.hasErrors('username')}" th:errors="*{username}" > </p>
    <p id="username-error"></p>
    <label> Password: </label>
    <input class="form-control" type="password" name="password" th:field="*{password}"/> <br> <br>
    <p class="alert alert-info" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"> </p>
    
    <label>Remember Me</label>
    <input type="checkbox" name="rememberMe" th:field="*{rememberMe}" value="true"/> <br>
    
    <button class="btn btn-secondary" type="submit" value="Login">Login</button>

  </form>

</div>

<script>

$(document).ready(function(){
	$("#username").keyup(function(){
		$.ajax({
			type:"GET",
			url:"ajax/is-user/"+$("#username").val(),
			success: function(result) {
				 if ($.trim(result) == '{}') {
					
				} else {
					console.log(result);
					var str = JSON.stringify(result);
					var data = JSON.parse(str);
					var res = data.response;
					console.log("Ready functions working.");
					if (res == true) {
						$('#username-error').html("Username already exists. Choose another username.");
						console.log("Username already exists. Choose another username.");
					}
				 } 
			}
		});
	});
});
</script>

</html>
