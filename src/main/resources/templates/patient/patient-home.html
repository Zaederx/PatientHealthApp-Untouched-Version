<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <style>
    .btn-space{
    	margin-right: 10px;
    }
    </style>
    <!-- CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

    <!-- JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <title>Patient Home</title>
  </head>
  <body>
  <!-- Header/Banner -->
    <div class="jumbotron text-center">
      <h1>Welcome Home</h1>
      <h3>Accessible health care at you convenience</h3>
      
      <!-- Navigation Bar -->
      <nav class="navbar navbar-expand-sm bg-dark navbar-dark justify-content-center row">
        <ul class="navbar-nav">
          <li class="nav-item" >
            <a class="nav-link" th:href="@{/patient/home}"><button class="btn btn-secondary active">User Home</button></a>
          </li>
          <li class="nav-item" >
            <a class="nav-link" href="@{/logout}"><button class="btn btn-primary">Logout</button></a>
          </li>
        
          <!-- <li class="nav-item" >
            <a class="nav-link" href="/home/register"><button class="btn btn-primary">Prescriptions</button></a>
          </li>
          -->
        </ul> 

      </nav>
    </div>
    
    <!-- Body div -->
    <div class="container col-sm-9" ><!-- style="background-color:grey;" -->
    	<br>
   
    	<div class="row">
	    	<!-- Active Prescriptions -->
	    	<div class="col-sm-6"> 
	    		<!-- Table -->
	    		<table class="table">
	    			<thead>
	    				<tr>
		    				<th colspan="2">Active Prescriptions</th>
	    				</tr>
	    			</thead>
	    			<tbody id="prescriptions">
	    			<!-- Fill via ajax method -->
	    			</tbody>
	    		</table>
	    	</div>
	    	
	    	<!-- Next Appointment -->
	    	<div class="col-sm-6">
	    		<!-- Table -->
	    		<table class="table">
	    			<thead>
	    				<tr>
		    				<th colspan="2">Next Appointment</th>
	    				</tr>
	    			</thead>
	    			<tbody id="appointment">
		    		<!-- Filled via ajax method -->
	    			</tbody>
	    		</table>
	    	</div>
    	</div>
    	
    	<br><br><br><br><br><br>
    </div>
    
  
  </body>
  <script>
  
  //RETRIEVE
  /* Method to retrieve active prescriptions */
  $(document).ready(function(){
	  $.ajax({
		  type:'GET',
		  url:'/ajax/patient/prescriptions',
		  success:function(response) {
			  var dString = JSON.stringify(response);
			  var data = JSON.parse(dString);
			  if (data.count == 0) {
				  console.log("data count zero if statement");
				  $('#prescriptions').html("<tr><td>No Active Prescriptions</td></tr>");
			  } else {
				  for (var i = 0 ; i < data.count; i++ ) {
					  var m = '<row><td>'+data.prescriptions[i].medication.name+'</td>'
					  + '<td><button onclick="editPrescription('+data.prescriptions[i].id+')" class="btn btn-primary btn-space">Edit</button>'
					  +'<button onclick="deletePrescription('+data.prescriptions[i].id+')\;" class="btn btn-primary">Delete</button></td></row>';
				  	$('#prescriptions').html(m);
					 
				  }
			  }
		  },
		  error:function() {
			  $('#prescriptions').html("An error has occured. Please try refreshing the page.");
		  }
	  });
  });
  
  /* Method to retrieve next appointment */
  $(document).ready(function(){
	  $.ajax({
		  type:'GET',
		  url:'',
		  success:function(data) {
			  for (var i = 0 ; i < data.count; i++ ) {
				  var m = '<row><td>'+data.message+'</td>'
				  + '<td><button onclick="editAppointment('+data.id+')">Edit</button>'
				  +'<button onclick="deleteAppointment('+data.id+')\;">Delete</button></td></row>';
			  	$('#prescriptions').html(m);
			  }
		  },
		  error:function(){
			  
		  }
	  });
  });
  
  //FILL
  /* Method to fill active prescriptions */
  
  /* Method to fill Next appointment */
  
  </script>
</html>
